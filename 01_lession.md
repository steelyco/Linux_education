# Работа с железом в Linux

## Часть первая - sysfs, devtmpfs, udev

**Udev** - менеджер устройств, который позволяет на уровне пользователя общаться с железом, которое работает на уровне ядра
**Udev** сейчас работает в связке с виртуальными файловыми системами. Управляет правилами именования, правами доступа, символьными ссылками между /*sys* и /*dev*

Преимущества **Udev**:
	- работает на уровне пользователя
	- управляется событиями (подключение чего-во в систему, любое событие в аппаратной части)
	- понятные файлы конфигурации
	- держит в системе только файлы активных устройств
	- сохраняет имена устройств при переподключении
	- сам создает в каталоге /dev файлы устройств, которые присутствуют в системе 

> [!tip] *devtmpfs* - содержит те файлы, при помощи которых можно обращаться к устройствам

 Примеры того, что может быть в /**dev**:
 - *mem* - образ физической памяти ПК
 - *null* - пустое устройство, в которое можно отправлять ненужный вывод приложения
 - *pts* - псевдотерминалы, используемые другими приложениями
 - *urandom* - генератор случайных чисел
 - *sdx* - блочные устройства (sda, sdb и тд), диски, флешки и тд
 - *tty* - аппаратные терминалы, которые используются пользователем

В каталоге /**dev** находятся файлы устройств, в которых содержится информация, необходимая для операционной системы, для взаимодействия с этими устройствами, обычно это указатели на драйверы этого устройства



> [!tip] *Sysfs* - еще одна виртуальная файловая система, которая экспортирует информацию о драйверах и устройствах на уровень пользователей. Монтируется в каталог /**sys** - он содержит файлы, которые предоставляют информацию об устройствах

Примеры содержания каталога /**sys**:
- *devices*/ - все устройства , которые есть в системе в виде дерева
- *bus*/ - перечень шин, которые служат для передачи данных между функциональными блоками
- *driver*/ - драйверы
- *block*/ -  каталоги блочных устройств, не появится новое устройство пока не будет и подключенное устройство и драйвер к ней 
- *class*/ - группировка устройств по классам

> [!tip] *Procfs* - виртуальная файловая система имеет иерархическое представление о всех процессах в системе и состоянию ОС. Тут мы видим дерево всех запущенных процессов и информацию о них. Монтируется в каталог /**proc**

Примеры содержания каталога /**proc**:
- *PID*/ - информация о конкретном процессе
- *cpuinfo*/ - сведения о ЦПУ
- *devices*/ - перечень настроек устройств
- *mounts*/ - смонтированные файловые системы
- *sys*/ - доступная для редактирования информация о системе


## Часть вторая - управление модулями ядра

Для работы с модулями ядра, например, с драйверами устройств, предназначены следующие команды: 
- *lsmod* – информация о модулях ядра
- *lspci* – информация об устройствах PCI
- *lsusb* – информация о шине USB
- *rmmod* – удалить модуль
- *insmod* – установить модуль
- *modprobe* – деликатно выполнить действия с модулем

Отдельного внимания заслуживает инструменты работы с **udev – udevadm**, который может запускаться со следующими опциями: 
- *info* – получение информации из БД
- *trigger* – запросить события для устройства
- *settle* – дождаться завершения обработки
- *control* – управление демоном
- *monitor* – следить за событиями
- *test* – симулировать запуск события