# Загрузка системы

## Процесс загрузки системы

1. При запуске системы центральный процессор сбрасывается и начинает исполнение кода по фиксированному адресу (на этому адресе находится начальный загрузчик прошивки (BIOS/UEFI)). Далее BIOS/UEFI проводит проверки (самотестирование оборудования (POST)) и после прохождения проверок выбирает, согласно своим настройкам, носитель информации.
2. Загрузочный код из MBR (Master Boot Record) для BIOS или для GPT (GUID Partirion Table) EFI-приложение из ESP-раздела для UEFI загружает основной загрузчик (например, GRUB), который, в свою очередь, загружает ядро операционной системы и initramfs (начальную RAM-файловую систему) в оперативную память и передаёт им управление.
3. Ядро Linux инициализирует оборудование, загружает драйверы, монтирует initramfs как временную корневую файловую систему, находит и монтирует постоянную корневую файловую систему.
4. Ядро запускает первый пользовательский процесс с PID=1. В современных дистрибутивах это обычно systemd, который затем запускает все остальные системные службы.

pstree
dmesg - данные о последней загрузке
cat /var/log/dmesg - журнал событий ядра

## Процесс инициализации устройства системы systemd

Инициализация системы - это процесс запуска скриптов, подготавливающих операционную систему к работе. В данный момент главным стилем инициализации является systemd

Необходимым элементом работы **systemd** является **unit** (Модули):
- .*service* - сервисы
- .*mount* - точки монтирования 
- .*device* - устройства
- .*socket* - сокеты
Директория, где хранятся юниты, когда устанавливается новое ПО  - */usr/lib/systemd*
Директория для управления юнитами - */etc/systemd*

Управление *systemd* происходит командой **systemctl**:
- **systemctl** list-units - показать запущенные юниты
- **systemctl** start network.service - запустить демон сети
- **systemctl** status crond - показать статус демона планировщика

Помимо этих элементов есть еще группировка юнитов - .*target*  - последовательные вызовы юнитов. Благодаря этим таргетам можно переключать режим выполнения работы ОС.
Например:
- systemctl isolate reboot.target - выполнить таргет_reboot
- systemctl set-default -f multi-user.target - установить таргет multi-user в качестве режима загрузки по умолчанию
- systemctl reboot - перезагрузить ПК
- systemctl poweroff - выключить ПК

Для управления демонами используется команда *service* имя_демона с ключами:
- *start* - запустить;
- *status* - показать состояние;
- *stop* - остановить;
- *restart* - перезапустить;
- *reload* - перезагрузить конфигурационный файл службы.

Важная особенность **systemd** – гибкая система журналирования **journald** , собирающая информацию из различных источников и привязывающая ее к различным юнитам. 
Примеры ее использования:
- **journalctl –f** - просмотр сообщений в режиме реального времени